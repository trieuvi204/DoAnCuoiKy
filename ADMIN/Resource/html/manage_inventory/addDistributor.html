<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thêm Nhà Phân Phối</title>
  <link rel="stylesheet" href="../../css/manage_inventory/addDisttributor.css">
  <link rel="icon" href="../../img/Logo/logo_tt.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <!-- icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">


  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inder&display=swap" rel="stylesheet">
  <!-- AOS Libary -->
  <link href="../../../../Vendors/aos-master/dist/aos.css" rel="stylesheet">
  <script src="../../../../Vendors/aos-master/dist/aos.js"></script>

  <!-- jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  	<!-- sweet alert -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* set up */
    * {
      padding: 0px;
      margin: 0px;
      box-sizing: border-box;
    }

    /* Body */
    body {
      font-family: "Inder", sans-serif;
      font-weight: 400;
      font-style: normal;
      color: #37517e !important;
      min-height: 100vh;
      position: relative;
    }
  </style>
</head>

<body>
  <div class="row">
    <div class="col-lg-2">
      <div class="sidebar">
        <div class="avata">
          <img src="../../img/avata/con_meo.jpg" alt="avata">
					<p class="welcomback">Chào Mừng Trở Lại <strong id="userName"></strong></p>
        </div>
        <div class="menu">
          <ul>
            <li><a href="../../../index.html"><button id="dashbroad">Tổng Quan</button></a></li>
            <li><a href="../manage_booking/field_booking_management.html"><button id="manage_booking">Quản Lý Đặt Sân</button></a></li>
            <!-- <li><a href="../manage_service/manage_service.html"><button id="manage_service">Quản Lý Dịch Vụ Đi Kèm</button></a></li> -->
            <li><a href="../manage_inventory/inventory_drinks_management.html"><button class="index" id= "manage_inventory">Quản Lý Kho</button></a></li>
            <li><a href="../manage_membership/membership_management.html"><button id="manage_membership">Quản Lý Nhân Viên</button></a>
            </li>
            <li><a href="../manage_money/money_management.html"><button id="manage_money">Quản Lý Thu Chi</button></a></li>
            <li><a href="../client_list/client_list.html"><button id="manage_client_list">Danh Sách Khách Hàng</button></a></li>
          </ul>
        </div>
        <div class="logo">
          <div class="row">
            <div class="col-lg-8">
              <a href="../../../index.html">
                <img src="../../img/Logo/logo_tt.png" alt="logo">
              </a>
            </div>
            <div class="col-lg-4">
              <div class="some-function">
                <!-- <div class="alert-icon"><i class="fa-regular fa-bell"></i></div> -->
                <!-- <div class="setting-icon"><i class="fa-solid fa-gear"></i></div> -->
                <div class="log-out-icon"><a href="../../../../index.html"><i
                      class="fa-solid fa-right-from-bracket"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-10 overview">
      <div class="row title" data-aos="fade-up">
        <h2> <a href="distributorList.html">Danh Sách Nhà Phân Phối</a> / <a href="addDistributor.html">Thêm Nhà Phân
            Phối</a></h2>
      </div>
      <div class="add_item_function container-part" data-aos="fade-up" data-aos-delay="100">
        <div class="row ">
          <div class="title-function">
            <h3>Tạo Mới Nhà Phân Phối</h3>
          </div>
        </div>
        <div class="row">
          <div class="inputs">
            <div class="row">
              <div class="col-lg-4">
                <div class="distributors-name input">
                  <p>Tên Nhà Phân Phối</p>
                  <input type="text" id="tenNPP" placeholder="Nhập tên nhà phân phối">
                </div>
              </div>
              <div class="col-lg-4">
                <div class="distributors-Email input">
                  <p>Email</p>
                  <input type="email" id="email_npp" placeholder="Nhập email nhà phân phối">
                </div>
              </div>
              <div class="col-lg-4">
                <div class="distributors-Address input">
                  <p>Địa Chỉ</p>
                  <input type="text" id="diaChi" placeholder="Nhập địa chỉ nhà phân phối">
                </div>
              </div>
            </div>
            <div class="row">

              <div class="col-lg-4">
                <div class="distributors-PhoneNum input">
                  <p>Số Điện Thoại</p>
                  <input type="text" id="soDienThoai" placeholder="Nhập số điện thoại nhà phân phối">
                </div>
              </div>

            </div>
            <div class="row button">
              <button class="addBtn btn">Thêm Nhà Phân Phối</button>
              <a href="distributorList.html"><button class="exitBtn btn">Quay Lại</button></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</body>

<script>
  AOS.init();
</script>


<script>
  const usersDataApi = 'http://localhost:8000/distributors/module/v1/distributor/register/'; // Thay đổi URL API nếu cần

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelector('.addBtn').addEventListener('click', function (event) {
      event.preventDefault(); // Ngăn form nạp lại trang

      // Lấy giá trị các trường nhập liệu
      let tenNPP = document.querySelector('#tenNPP').value.trim();
      let diaChi = document.querySelector('#diaChi').value.trim();
      let soDienThoai = document.querySelector('#soDienThoai').value.trim();
      let email = document.querySelector('#email_npp').value.trim();

      // Kiểm tra ràng buộc các trường
      if (!tenNPP || !diaChi || !soDienThoai || !email) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo',
          text: 'Vui lòng điền đầy đủ thông tin các trường.'
        });
        return;
      }

      // Kiểm tra số điện thoại (phải có 10 số)
      let phoneRegex = /^[0-9]{10}$/;
      if (!phoneRegex.test(soDienThoai)) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo',
          text: 'Số điện thoại phải là 10 chữ số.'
        });
        return;
      }

      // Kiểm tra định dạng email
      let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo',
          text: 'Vui lòng nhập đúng định dạng email.'
        });
        return;
      }

      // Tạo đối tượng dữ liệu
      var formDataDistributor = {
        ten_npp: tenNPP,
        dc_npp: diaChi,
        sdt_npp: soDienThoai,
        email_npp: email
      };

      // Gửi dữ liệu đến API
      createDistributor(formDataDistributor);
    });
  });

  document.addEventListener('DOMContentLoaded', function() {
    // Lấy chức vụ từ sessionStorage
    const userRole = sessionStorage.getItem('chuc_vu');
    const userCode = sessionStorage.getItem('ma_nv');
    
    // Tham chiếu tới input mã nhân viên
    const maNVInput = document.getElementById('maNV');

    if (!userRole) {
        console.error('User role not found in sessionStorage.');
        return;
    }

    if (userRole === 'nhap-hang') {
        maNVInput.value = userCode; // Mã nhân viên cố định
        maNVInput.disabled = true; // Vô hiệu hóa input
        maNVInput.title = 'Mã nhân viên cố định cho nhân viên nhập hàng'; // Tooltip
    } else {
        console.warn(`Chức vụ ${userRole} không có hành động đặc biệt.`);
    }
  });

  function createDistributor(data) {
    var option = {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    };

    fetch(usersDataApi, option)
      .then(function (response) {
        return response.json();
      })
      .then(function(response) {
        if(response.ma_npp) {
          Swal.fire({
            icon: 'success',
            title: 'Đăng ký thành công',
            text: 'Thông tin nhà phân phối đã được đăng ký.'
          }).then(() => {
            window.location.reload();
          });
        }
      })
      .catch(function (error) {
        console.error('Error:', error);
        Swal.fire({
          icon: 'error',
          title: 'Có lỗi xảy ra',
          text: 'Đã xảy ra lỗi. Vui lòng thử lại.'
        });
      });
  }
</script>

<script src="../../js/rolePermissions.js"></script>


</html>